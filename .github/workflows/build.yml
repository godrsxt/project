# .github/workflows/build.yml
name: KivyMD Android CI

on:
  push:
    branches: [ main ] # Trigger automatically when code is pushed to the 'main' branch
  
  workflow_dispatch: # Allows manual triggering from the GitHub Actions tab

jobs:
  build:
    # Uses the latest Ubuntu runner (currently 24.04)
    runs-on: ubuntu-latest

    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        # Action to pull your code into the runner
        uses: actions/checkout@v4

      # ü©π FIX for "E: Unable to locate package libtinfo5" NDK dependency issue
      - name: ü©π Install libncurses5 for NDK compatibility
        run: |
          sudo apt-get update
          # libncurses5 installs the older libtinfo5 dependency required by the NDK
          sudo apt-get install -y libncurses5
      
      - name: ‚öôÔ∏è Cache Buildozer Dependencies
        # Caching the .buildozer directory dramatically speeds up subsequent builds
        uses: actions/cache@v4
        with:
          path: .buildozer
          key: ${{ runner.os }}-${{ hashFiles('buildozer.spec') }}

      - name: üèóÔ∏è Build APK with Buildozer Action
        # This action simplifies the entire Android SDK/NDK setup
        uses: digreatbrian/buildozer-action@v2 
        id: buildozer
        with:
          # ‚úÖ CORRECTED: Using supported Python 3.11, which you confirmed worked
          python-version: 3.11 
          # Command to run Buildozer; 'android debug' creates the APK
          buildozer-cmd: buildozer -v android debug 

      - name: ‚¨ÜÔ∏è Upload Artifact (APK)
        # Action to save the resulting APK file so you can download it
        uses: actions/upload-artifact@v4
        with:
          name: KivyMD-Quiz-APK
          # The APK is created in the 'bin' directory
          path: ./bin/*.apk 
